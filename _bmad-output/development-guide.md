# Development Guide

## Prerequisites

- **Node.js:** v20 or higher
- **npm:** v10 or higher
- **Git:** For version control
- **Supabase Account:** For database (optional, has in-memory fallback)

## Quick Start

```bash
# Clone repository
git clone <repo-url>
cd trustbot-system

# Install dependencies (root + web)
npm install
cd web && npm install && cd ..

# Set up environment
cp .env.example .env
# Edit .env with your credentials

# Run tests
npm test

# Start API server
npm run api

# Start Web UI (separate terminal)
npm run web
```

## Environment Variables

Create a `.env` file in the project root:

```env
# Supabase (optional - falls back to in-memory)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id

# AI Providers (optional)
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...
XAI_API_KEY=xai-...
GOOGLE_AI_API_KEY=...

# Security
MASTER_KEY=your-secure-master-key

# Server
PORT=3010
NODE_ENV=development
```

## Project Scripts

### Root (Backend)

| Script | Description |
|--------|-------------|
| `npm run dev` | Start with hot reload (tsx watch) |
| `npm run api` | Start API server |
| `npm run build` | Compile TypeScript |
| `npm start` | Run compiled code |
| `npm test` | Run tests |
| `npm run test:run` | Run tests once |
| `npm run test:coverage` | Run with coverage |
| `npm run test:ui` | Vitest UI |
| `npm run game` | Start game mode |

### Web (Frontend)

| Script | Description |
|--------|-------------|
| `npm run dev` | Start Vite dev server |
| `npm run build` | Build for production |
| `npm run preview` | Preview production build |

## Development Workflow

### 1. Start Services

```bash
# Terminal 1: API Server
npm run api
# Runs on http://localhost:3010

# Terminal 2: Web UI
npm run web
# Runs on http://localhost:3000
```

### 2. Make Changes

- **Backend:** Edit files in `src/`, auto-reload with `npm run dev`
- **Frontend:** Edit files in `web/src/`, Vite hot reloads

### 3. Run Tests

```bash
# Run all tests
npm test

# Run specific test file
npm test -- src/core/TrustEngine.test.ts

# Run with coverage
npm run test:coverage
```

### 4. Build

```bash
# Backend
npm run build

# Frontend
cd web && npm run build
```

## Code Style

### TypeScript

- Strict mode enabled
- ES2022 target
- ESModules (`"type": "module"`)
- File extensions required in imports (`.js`)

### Testing

- Framework: Vitest
- Coverage thresholds: 70%
- Test files: `*.test.ts` or `*.spec.ts`

### Naming Conventions

| Type | Convention | Example |
|------|------------|---------|
| Files | PascalCase | `TrustEngine.ts` |
| Classes | PascalCase | `class TrustEngine` |
| Functions | camelCase | `function createAgent()` |
| Constants | UPPER_SNAKE | `const MAX_TRUST = 1000` |
| Types | PascalCase | `type AgentId = string` |

## Deployment

### Backend (Fly.io)

```bash
# Install Fly CLI
curl -L https://fly.io/install.sh | sh

# Login
fly auth login

# Deploy
fly deploy
```

### Frontend (Vercel)

```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
cd web
vercel --prod
```

## Database Setup

### Supabase

1. Create a Supabase project
2. Run `supabase/schema.sql` in the SQL Editor
3. Copy URL and anon key to `.env`

### Local Development

Without Supabase, the API falls back to in-memory storage. Data persists only for the session.

## Troubleshooting

### API won't start
- Check `.env` file exists
- Verify PORT is not in use
- Check Node.js version (need v20+)

### Tests failing
- Run `npm install` to update dependencies
- Check for type errors: `npm run build`

### Web UI blank
- Check API is running
- Open DevTools console for errors
- Verify API URL in `web/src/api.ts`

---

## Architecture Decisions

### Why Hono?
- Lightweight, fast
- TypeScript-first
- Works with Node.js and edge runtimes

### Why Supabase?
- PostgreSQL with real-time subscriptions
- Built-in auth
- Easy to set up

### Why Vitest?
- Fast, native ESM support
- Compatible with Jest API
- Great VS Code integration

---

*Generated by BMad Method document-project workflow*
